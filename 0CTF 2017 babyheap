
è„‘å­æ˜¯ä¸å¤Ÿç”¨äº† è®°ä¸‹æ¥å¥½äº†
åœ¨CTFwiki å’Œ ä¸ç¥çš„åšå®¢çœ‹åˆ°äº†ä¸¤ç§leakçš„æ–¹æ³• éƒ½å¾ˆå·§å¦™äº†

ä¸ç¥çš„æ–¹æ³•
https://blog.csdn.net/qq_29343201/article/details/66476135
åˆ©ç”¨å †æº¢å‡ºä¿®æ”¹chunk_sizeï¼Œé€ æˆchunk overlapï¼Œdumpçš„æ—¶å€™å°±å¯ä»¥æŠŠåé¢ä¸€ä¸ªchunkçš„fdå’Œbkæ˜¾ç¤ºå‡ºæ¥äº†


åˆ†é…chunk 0ï¼ˆsize = 0x60ï¼‰åˆ†é…chunk1ï¼ˆ0x40ï¼‰
+---------------+---------------+------------------+
|               |               |                  |
|     chunk 0   |    chunk 1    |      chunk 1     |
|      0x60     |   head(0x10)  |     content 0x40 |
|               |               |                  |
+---------------+---------------+------------------+
pwndbg> x/50gx 0x5566684e9000
0x5566684e9000:	0x0000000000000000	0x0000000000000071
0x5566684e9010:	0x0000000000000000	0x0000000000000000
0x5566684e9020:	0x0000000000000000	0x0000000000000000
0x5566684e9030:	0x0000000000000000	0x0000000000000000
0x5566684e9040:	0x0000000000000000	0x0000000000000000
0x5566684e9050:	0x0000000000000000	0x0000000000000000
0x5566684e9060:	0x0000000000000000	0x0000000000000000
0x5566684e9070:	0x0000000000000000	0x0000000000000051
0x5566684e9080:	0x0000000000000000	0x0000000000000000

ä»chunk 0æ”¹å†™chunk1çš„å¤´ï¼Œæ”¹æˆ0x71
å†åˆ†é…ä¸€ä¸ªchunk2 ï¼ˆ0x100)

                                    fake chunk 1 ï¼ˆ0x70)
                +-----------------------------------------------------------+-
                |                                                           |
                |                                                           |
                |                                                           |
+-------------------------------+------------------+-------------+------------------------+
|               |               |                  |             |          |
|     chunk 0   |    chunk 1    |      chunk 1     |   chunk 2   | content  |   content
|      0x60     |   head(0x10)  |     content 0x40 |  head(0x10) |  (0x10)  |
|               |               |                  |             |          |
+---------------+---------------+------------------+-------------+----------+-------------+
0x56503d5e2000:	0x0000000000000000	0x0000000000000071
0x56503d5e2010:	0x6161616161616161	0x6161616161616161
0x56503d5e2020:	0x6161616161616161	0x6161616161616161
0x56503d5e2030:	0x6161616161616161	0x6161616161616161
0x56503d5e2040:	0x6161616161616161	0x6161616161616161
0x56503d5e2050:	0x6161616161616161	0x6161616161616161
0x56503d5e2060:	0x6161616161616161	0x6161616161616161
0x56503d5e2070:	0x0000000000000000	0x0000000000000071
0x56503d5e2080:	0x0000000000000000	0x0000000000000000
0x56503d5e2090:	0x0000000000000000	0x0000000000000000
0x56503d5e20a0:	0x0000000000000000	0x0000000000000000
0x56503d5e20b0:	0x0000000000000000	0x0000000000000000
0x56503d5e20c0:	0x0000000000000000	0x0000000000000111
0x56503d5e20d0:	0x0000000000000000	0x0000000000000000

è¿™ä¸ªæ—¶å€™free chunk 1å°±å¯ä»¥æŠŠfake chunk å˜æˆçœŸ chunkäº† ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜èƒ½ç¼–è¾‘chunk 2 çš„å†…å®¹ 
æˆ–è®¸è¿™å°±å«åšoverlapå§
ä½†æ˜¯åœ¨free chunk 1ä¹‹å‰ è¿˜éœ€è¦è¿‡freeå¯¹ next sizeçš„æ£€æŸ¥
åœ¨chunk 2 çš„contenté‡Œä¼ªé€ ä¸€ä¸ªå¤´éƒ¨å°±å¥½äº†
                                    fake chunk 1 ï¼ˆ0x70)
                +-----------------------------------------------------------+-
                |                                                           |
                |                                                           |
                |                                                           |
+-------------------------------+------------------+-------------+------------------------+
|               |               |                  |             |          |
|     chunk 0   |    chunk 1    |      chunk 1     |   chunk 2   | content  |   fake head
|      0x60     |   head(0x10)  |     content 0x40 |  head(0x10) |  (0x10)  |   (0x10)
|               |               |                  |             |          |
+---------------+---------------+------------------+-------------+----------+-------------+

0x563a6f582000:	0x0000000000000000	0x0000000000000071
0x563a6f582010:	0x6161616161616161	0x6161616161616161
0x563a6f582020:	0x6161616161616161	0x6161616161616161
0x563a6f582030:	0x6161616161616161	0x6161616161616161
0x563a6f582040:	0x6161616161616161	0x6161616161616161
0x563a6f582050:	0x6161616161616161	0x6161616161616161
0x563a6f582060:	0x6161616161616161	0x6161616161616161
0x563a6f582070:	0x0000000000000000	0x0000000000000071
0x563a6f582080:	0x0000000000000000	0x0000000000000000
0x563a6f582090:	0x0000000000000000	0x0000000000000000
0x563a6f5820a0:	0x0000000000000000	0x0000000000000000
0x563a6f5820b0:	0x0000000000000000	0x0000000000000000
0x563a6f5820c0:	0x0000000000000000	0x0000000000000111
0x563a6f5820d0:	0x6161616161616161	0x6161616161616161
0x563a6f5820e0:	0x0000000000000000	0x0000000000000071
0x563a6f5820f0:	0x0000000000000000	0x0000000000000000

free chunk 1ä¹‹ååœ¨ allocate ä¸€ä¸ª 0x60å¤§å°çš„chunk1 
è¿™ä¸ªæ—¶å€™free chunk2 çš„è¯ åœ¨chunk 1 çš„content é‡Œé¢å°±ä¼šæœ‰ chunk2 çš„fdã€bkäº† 
dump chunk 1 å°±å®Œæˆäº† leak
ä½†æ˜¯åœ¨è¿™é“é¢˜ä¸­ allocate chunkçš„è¯ä¼šå°† contentæ¸…ç©º 
æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®å¤ä¸€ä¸‹ chunk 2 head è®©ä»–æ¢å¤åˆ°ä¸Šé¢ğŸ‘†çš„æ ·å­
å¹¶ä¸”è¿˜éœ€è¦å†åˆ†é…ä¸€ä¸ªchunk é˜²æ­¢free chunk 2çš„æ—¶å€™ä¸top chunkåˆå¹¶
ä¹‹åå† free chunk2 å† dump chunk 1 
è¿™ä¸ªæ—¶å€™å †çš„æƒ…å†µï¼š
                                         chunk 1 ï¼ˆ0x70)
                +-----------------------------------------------------------+-
                |                                                           |
                |                                                           |
                |                                                           |
+-------------------------------+------------------+-------------+------------------------+
|               |               |                  |             |          |
|     chunk 0   |    chunk 1    |      chunk 1     |   chunk 2   |   libc   |   fake head
|      0x60     |   head(0x10)  |     content 0x40 |  head(0x10) |  fdã€bk   |
|               |               |                  |             |          |
+---------------+---------------+------------------+-------+-----+----------+-------------+
                                                           ^
                                                           |
                                                       recovered
0x56008e378000:	0x0000000000000000	0x0000000000000071
0x56008e378010:	0x6161616161616161	0x6161616161616161
0x56008e378020:	0x6161616161616161	0x6161616161616161
0x56008e378030:	0x6161616161616161	0x6161616161616161
0x56008e378040:	0x6161616161616161	0x6161616161616161
0x56008e378050:	0x6161616161616161	0x6161616161616161
0x56008e378060:	0x6161616161616161	0x6161616161616161
0x56008e378070:	0x0000000000000000	0x0000000000000071
0x56008e378080:	0x6161616161616161	0x6161616161616161
0x56008e378090:	0x6161616161616161	0x6161616161616161
0x56008e3780a0:	0x6161616161616161	0x6161616161616161
0x56008e3780b0:	0x6161616161616161	0x6161616161616161
0x56008e3780c0:	0x0000000000000000	0x0000000000000111
0x56008e3780d0:	0x00007f9ac37e5b78	0x00007f9ac37e5b78  <----libc fdã€bk
0x56008e3780e0:	0x0000000000000000	0x0000000000000071
0x56008e3780f0:	0x0000000000000000	0x0000000000000000

å†æ¥çœ‹ä¸€ä¸‹CTF WIKIä¸Šç»™çš„leakçš„æ–¹æ³•









